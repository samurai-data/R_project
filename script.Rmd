---
title: "R_projet"
author: "Inessa Kim, Mai-Anh Pham, Nao Ueda"
date: 'Dernière modif : `r format(Sys.Date(), format = "%d/%m/%Y")`'
output:
  html_document:
    number_sections: yes # pour ajouter des numéros aux titres
    toc: yes # ajout d'une table des matières
    toc_depth : '3' # Précision de la table des matières
    toc_float: true # Laisser la table des matières constamment
    code_folding: hide
---


# Introduction

La santé mentale est un sujet crucial du XXIème siècle qui est devenu un enjeu majeur lors de la pandémie du COVID-19. Des nombreuses études montrent que la pandémie du COVID-19 a entrainé une hausse mondiale des problèmes de santé mentales, y compris la dépression et l’anxiété généralisée.  

En effet, la propagation du virus s’est accompagnée d’une montée de l’inquiétude face à l’infection et de la mise en place de mesures restrictives ainsi que du confinement. Par ailleurs, l’isolement, la baisse d’activité physique, l’augmentation du stress et l’organisation du travail à domicile couplée à la gestion de la vie familiale sont également des facteurs qui peuvent avoir un impact sur la santé mentale.

Ainsi, pour cette étude nous nous sommes intéressées à la santé mentale et le bien-être des Français et, notamment, aux inégalités femmes-hommes dans les deux vagues de l’enquête ELIPSS « Faire face au Covid-19 ». Le fait d’observer les deux vagues de l’enquête nous permet de comparer les résultats entre le début du premier confinement et quelques mois après sa fin.

*Présentation des données*

La base de données utilisée pour notre étude provient de l’enquête Coping with COVID-19 dont l’objectif est de mesurer l’expérience social du confinement en France. Cette enquête s’est appuyée sur un dispositif empirique préexistant - ELIPSS, un panel représentatif d’environ un millier de répondants suivis longitudinalement - et l’a transformé en un baromètre permettant de suivre l’expérience du confinement en France à des intervalles réguliers (5 vagues d’enquêtes de début avril à fin mai 2020).

*Plan*

Dans un premier temps, nous allons présenter le profil général de la population observée ainsi que les variables déterminantes du bien-être et de la santé mentale. Ensuite, nous allons nous concentrer sur les facteurs qui peuvent avoir un impact sur la santé mentale des personnes enquêtées. Enfin, nous allons présenter les résultats principaux de notre étude dans la partie finale de notre dossier.  


# Partie principale

*Chargement des données et des libraries*

```{r,warning=FALSE, message=FALSE, class.source = "fold-show"}

library(tidyverse)
library(questionr)
library(readr)
library(knitr)
library(kableExtra)
library(ggplot2)
library(gt)
library(tibble)
library(sf)

# Vague 1 et vague 6
coco1 <- read.csv("fr.cdsp.ddi.elipss.202004coco1.csv")
coco6 <- read.csv("fr.cdsp.ddi.elipss.202010.csv")
```


## L'obsérvation des caractéristiques socio-démographiques de la population etudiée

L'objectif est de présenter les caractéristiques principales des répondants à l'enquête. 

###  Le sexe et l'âge
*Sexe*
```{r, box.title = "Sexe", solution = T}
fct_freq_sexe <- function(x){
  recod <- fct_collapse(factor(x),
  "Homme"="1",
  "Femme"="2")
  return(recod)
}

# Recodage
coco1$sexe <- fct_freq_sexe(coco1$eayy_A1)
coco6$sexe <- fct_freq_sexe(coco6$eayy_A1)


#poids de pourcentagesde sexe par vague1 
round(wtd.table(coco1$sexe, weights = coco1$coco1_POIDS,
          useNA = "ifany") %>% 
  prop.table()*100,1)#<<


#poids de pourcentagesde sexe par vague6 
round(wtd.table(coco6$sexe, weights = coco6$POIDS_coco6,
          useNA = "ifany") %>% 
  prop.table()*100,1)#<<
```

*Age*
```{r}
fct_freq_age <- function(x){
  recod <- fct_collapse(factor(x),
                        "Moins de 29 ans"=c("4","5"), 
                        "De 30 à 39 ans"=c("6","7"), 
                        "De 40 à 49 ans"=c("8","9"), 
                        "De 50 à 59 ans"=c("10","11"),
                        "Plus de 60 ans"=c("12","13","14"))
  return(recod)
}

# Recodage
coco1$age <- fct_freq_age(coco1$eayy_A2A_rec)
coco6$age <- fct_freq_age(coco6$eayy_A2A_rec)


# Tableau vague 1(âge et sexe) :
pop_vague1<- wtd.table(coco1$age,coco1$sexe,  
          weights = coco1$coco1_POIDS, useNA = "ifany") %>% 
  prop(digits=1)

# Tableau vague 6(âge et sexe) :
pop_vague6<-wtd.table(coco6$age,coco6$sexe,  
          weights = coco6$POIDS_coco6, useNA = "ifany") %>% 
  prop(digits=1)

#fusionner les deux vagues
pop_vague <- cbind(pop_vague1, pop_vague6)
#presenter le tableau

pop_vague_df <- as.data.frame(pop_vague)
colnames(pop_vague_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")


pop_vague_df <- rownames_to_column(pop_vague_df, "Classes d'âge")


pop_vague_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = c(4,7)))
```

Les répondants à notre enquête proviennent des vagues 1 et 6. Le rapport entre les sexes est de 49:51 dans les deux cas, avec une proportion légèrement plus élevée des femmes.
En conséquence, si l'on considère le rapport hommes/femmes par groupe d'âge, on constate que, tant pour la première que pour la sixième vague, la proportion des femmes est supérieure à celle des hommes de moins de 49 ans. En particulier, une grande différence peut être observée lors de la première vague, où 39.4% des hommes et 60.6% des femmes sont âgés de moins de 29 ans, et lors de la sixième vague, où 39.5% des hommes et 60.5% des femmes sont âgés de 30 à 39 ans.3 Les analyses futures devraient tenir compte du rapport entre les hommes et les femmes de moins de 49 ans.

### Catégories socioproféssionnelles

```{r, warning=FALSE}
# Groupe socio-professionnel en 6 postes :eayy_PCS6
fct_freq_sociopro <- function(x){
  recod <- fct_collapse(factor(x),
                        "Agriculteurs exploitants"="1",
                        "Artisans, commerçants et chefs d'entreprise"="2", 
                        "Cadres et professions intellectuelles supérieures"="3",
                        "Professions intermédiaires"="4",
                        "Employés"="5", "Ouvriers"="6",
                        "Ne sait pas "=c("66","666" ,"999"))
  return(recod)
}

# Recodage

coco1$sociopro <- fct_freq_sociopro(coco1$eayy_PCS6)
coco6$sociopro <- fct_freq_sociopro(coco6$eayy_PCS6)

# vague 1
popsoc_vague1 <- wtd.table(coco1$sociopro,coco1$sexe, weights = coco1$coco1_POIDS,
          useNA = "ifany", exclude = "Ne sait pas") %>%
  prop(digits=1)
#vague 6
popsoc_vague6 <- wtd.table(coco6$sociopro,coco6$sexe, weights = coco6$POIDS_coco6,
          useNA = "ifany", exclude = "Ne sait pas") %>%
  prop(digits=1)

#fusionner les deux vagues
popsoc_vague <- cbind(popsoc_vague1, popsoc_vague6)

#presenter le tableau
popsoc_vague_df <- as.data.frame(popsoc_vague)
colnames(popsoc_vague_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

popsoc_vague_df <- rownames_to_column(popsoc_vague_df, "Classification professionnelle de la population")

pop_vague_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = c(4,7)))

```

Des comparaisons ont été faites entre les professions des hommes et des femmes interrogés. Trois professions distinctes ont été identifiées : cadres et professions intellectuelles supérieures, professions intermédiaires et employés. cadres et professions Les Cadres et professions intellectuelles supérieures sont à prédominance masculine plutôt que féminine. Les employés, en revanche, sont beaucoup plus nombreux chez les femmes que chez les hommes. Et les professions intermédiaires sont moins sexistes. Cette classification des professions montre que les hommes sont plus susceptibles d'avoir un travail physique et un statut élevé, tandis que les femmes sont plus susceptibles d'avoir des Employés.
Il s'agit d'une tendance observée à la fois dans la vague 1 et la vague 6. Cela signifie que le confinement n'a aucun impact sur les professions.

### Seul ou en couple

```{r}
fct_freq_couple <- function(x){
  recod <- fct_collapse(factor(x),
  "Couple cohabitation"="1", 
  "Couple non-cohabitation"="2", 
  "Ne pas en couple"="3")
  return(recod)
}

# Recodage
coco1$couple <- fct_freq_couple(coco1$eayy_A5)
coco6$couple <- fct_freq_couple(coco6$eayy_A5)

# Tableau de croise vague 1(couple et sexe) :
couple_vague1<-wtd.table(coco1$couple,coco1$sexe,
          weights = coco1$coco1_POIDS, useNA = "ifany") %>% 
  prop(digits=1)

# Tableau de croise vague 6(couple et sexe) :
couple_vague6<-wtd.table(coco6$couple,coco6$sexe,
          weights = coco6$POIDS_coco6, useNA = "ifany") %>% 
  prop(digits=1)

#fusionner les deux vagues
t_couple <- cbind(couple_vague1, couple_vague6)

#presenter le tableau
couple_df <- as.data.frame(t_couple)
colnames(couple_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

couple_df <- rownames_to_column(couple_df, "Classification professionnelle de la populatoin de l'étude")

couple_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = c(4,7)))
```

La cohabitation des couples est ensuite comparée.
La cohabitation en couple est répartie à peu près à parts égales entre les sexes. Cependant, dans les couples non cohabitants, les femmes sont environ 60% plus nombreuses que les hommes, tant à la vague 1 qu'à la vague 6. Et de la vague 1 à la vague 6, le couple non cohabitant a diminué de 3% chez les hommes, alors qu'il a augmenté de 4% chez les femmes. Ce changement n'est pas très important, mais le fait qu'il y ait une augmentation ou une diminution, plutôt qu'une diminution des deux, suggère qu'il y a un facteur en jeu.


## Les sentiments negatifs

Comment les hommes et les femmes se sentent-ils chacun pendant le confinement ? Et y a-t-il des changements mentaux entre la première et la sixième vague ? On compare les différences entre les hommes et les femmes en fonction de quatre émotions : la solitude, la nervosité, le décourage et la tristesse, ainsi que lors de la première et de la sixième vague.

### Solitude
```{r, warning=FALSE}
# Créer la fonction solitude

fct_freq_senti_solitude <- function(x){
  recod <- fct_collapse(factor(x),
  "Très seul"="1", 
  "Plutôt seul"="2", 
  "Plutôt entoure"="3",
  "Très entourét"="4",
  "Ne sait pas" = "9999")
  return(recod)
}

#Recodage
coco1$solitude <- fct_freq_senti_solitude(coco1$coco1_q21)
coco6$solitude <- fct_freq_senti_solitude(coco6$coco6_Q21)

```

```{r}
solitude1<-wtd.table(coco1$solitude,coco1$sexe,
          weights = coco1$coco1_POIDS, useNA = "ifany") %>% 
  prop(digits=1)

solitude6<-wtd.table(coco6$solitude,coco6$sexe,
          weights = coco6$POIDS_coco6, useNA = "ifany",exclude = "Ne sait pas") %>% 
  prop(digits=1)
```

*Graphique : Solitude* 
```{r}
vg1_genre_solitude <- rprop(table(sexe=coco1$sexe,
            solitude=coco1$solitude))
vg1_genre_solitude

vg1_genre_solitude %>% 
  data.frame() %>% 
  filter(solitude !="Total") %>% 
  ggplot()+
  aes(fill=sexe, x=solitude, y= Freq) %>% 
  geom_bar(col="black",stat="identity", position="dodge")+
  labs(title="Solitudé selon le genre pendant le 1er confinement",
       x="C'est senti·e solitudé",y="%",fill="",
       caption = "Source : Coco1 - ELIPSS, CDSP, avril 2020")+
  viridis::scale_fill_viridis(discrete=T)+
  theme_bw()
```

```{r}
vg6_genre_solitude <- rprop(table(sexe=coco6$sexe,
            solitude=coco6$solitude))
vg6_genre_solitude

vg6_genre_solitude %>% 
  data.frame() %>% 
  filter(solitude !="Total") %>% 
  ggplot()+
  aes(fill=sexe, x=solitude, y= Freq) %>% 
  geom_bar(col="black",stat="identity", position="dodge")+
  labs(title="Solitudé selon le genre pendant le 1er confinement",
       x="C'est senti·e solitudé",y="%",fill="",
       caption = "Source : Coco6 - ELIPSS, CDSP, Octobre 2020")+
  viridis::scale_fill_viridis(discrete=T)+
  theme_bw()
```

```{r}
coco1 %>% 
  filter(is.na(solitude)==F) %>% 
ggplot()+
  aes(fill=solitude, x=sexe)+
  geom_bar(position="fill")
```

```{r}
coco6 %>% 
  filter(is.na(solitude)==F) %>% 
ggplot()+
  aes(fill=solitude, x=sexe)+
  geom_bar(position="fill")

#fusionner les deux vagues
s_solitude <- cbind(solitude6, solitude6)
#presenter le tableau

s_solitude_df <- as.data.frame(s_solitude)
colnames(s_solitude_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

s_solitude_df <- rownames_to_column(s_solitude_df, "Degré de solitude")

#library(gt)
s_solitude_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))

```

La première est la solitude. Lors de la première vague, 1,2% des hommes se sentaient fortement seuls. Cela signifie que lors de la première vague, les hommes se sont sentis plus fortement seuls que les femmes(0.6%). Cependant, lors de la sixième vague, ce chiffre était de 0.6%. Les hommes connaissent une tendance à la baisse de la solitude. Toutefois, la solitude des femmes ne change pas du tout. 

### Degré des Nerveux, Decourage et Triste

```{r,warning=FALSE}
# Créer la fonction
fct_freq_senti <- function(x){
  recod <- fct_collapse(factor(x),
  "En permanence"="1", 
  "Souvent"="2", 
  "Quelques fois"="3",
  "Rarement"="4",
  "Jamais" = "5",
  "Ne sait pas" = "9999"
  )
  return(recod)
}

#la fonction pour le sentiment 'nerveux' vague 1 uniquement 
fct_freq_senti_nerv <- function(x){
  recod <- fct_collapse(factor(x),
                        "En permanence"="1", 
                        "Souvent"="2", 
                        "Quelques fois"="3",
                        "Rarement"="4",
                        "Jamais" = "5"
  )
  return(recod)
}
# Recodage
coco1$nerveux <- fct_freq_senti_nerv(coco1$coco1_q16)
coco1$decourage <- fct_freq_senti(coco1$coco1_q17)
coco1$triste <- fct_freq_senti(coco1$coco1_q19)

coco6$nerveux <- fct_freq_senti(coco6$coco6_Q16)
coco6$decourage <- fct_freq_senti(coco6$coco6_Q17)
coco6$triste <- fct_freq_senti(coco6$coco6_Q19)

```


*Nerveux*
```{r}
nerveux1<-wtd.table(coco1$nerveux,coco1$sexe,
          weights = coco1$coco1_POIDS, useNA = "ifany") %>% 
  prop(digits=1)

nerveux6<-wtd.table(coco6$nerveux,coco6$sexe,
          weights = coco6$POIDS_coco6, useNA = "ifany") %>% 
  prop(digits=1)

```
*Graphique : Nerveux*
```{r}
coco1 %>% 
  filter(is.na(nerveux)==F) %>% 
ggplot()+
  aes(fill=nerveux, x=sexe)+
  geom_bar(position="fill")
```

```{r}
coco6 %>% 
  filter(is.na(nerveux)==F) %>% 
ggplot()+
  aes(fill=nerveux, x=sexe)+
  geom_bar(position="fill")

#fusionner les deux vagues
s_nerveux <- cbind(nerveux6, nerveux6)
#presenter le tableau

s_nerveux_df <- as.data.frame(s_nerveux)
colnames(s_nerveux_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

s_nerveux_df <- rownames_to_column(s_nerveux_df, "Degré de nerveux")

#library(gt)
s_nerveux_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))
```

Ensuite, la nervosité. Si l'on compare les hommes et les femmes, le pourcentage d'hommes et de femmes qui sont toujours nerveux est la presque même lors de la vague1, mais cette tendance est plus forte chez les hommes. Cependant, lors de les vagues 1 et 6, en general, les femmes étaient toujours plus nerveuses que les hommes. Cela suggère que certains facteurs ont rendu les femmes plus négatives dans une période prolongée de confinement.

*Decourage*
```{r}
decourage1<-wtd.table(coco1$decourage,coco1$sexe,
          weights = coco1$coco1_POIDS, useNA = "ifany") %>% 
  prop(digits=1)

decourage6<-wtd.table(coco6$decourage,coco6$sexe,
          weights = coco6$POIDS_coco6, useNA = "ifany") %>% 
  prop(digits=1)
```

 *Graphique : Decourage*
```{r}
coco1 %>% 
  filter(is.na(decourage)==F) %>% 
ggplot()+
  aes(fill=nerveux, x=sexe)+
  geom_bar(position="fill")
```

```{r}
coco6 %>% 
  filter(is.na(decourage)==F) %>% 
ggplot()+
  aes(fill=nerveux, x=sexe)+
  geom_bar(position="fill")

#fusionner les deux vagues
s_decourage <- cbind(decourage6, decourage6)
#presenter le tableau

s_decourage_df <- as.data.frame(s_decourage)
colnames(s_decourage_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

s_decourage_df <- rownames_to_column(s_decourage_df, "Degré de decourage")

s_decourage_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))
```

Et le découragement ne montre pas de différence significative entre les hommes et les femmes, mais la proportion de femmes de la vague 1 à la vague 6 augmente dans " souvent ", alors que la proportion d'hommes et de femmes qui ressentent le découragement " jamais " tend à diminuer. Le confinement n'a pas du tout d'impact sur les hommes et les femmes.

*Triste*
```{r}
triste1 <- wtd.table(coco1$triste,coco1$sexe,
          weights = coco1$coco1_POIDS, useNA = "ifany") %>% 
  prop(digits=1)

triste6 <- wtd.table(coco6$triste,coco6$sexe,
          weights = coco6$POIDS_coco6, useNA = "ifany") %>% 
  prop(digits=1)
```

*Graphique : triste*
```{r}
coco1 %>% 
  filter(is.na(triste)==F) %>% 
ggplot()+
  aes(fill=nerveux, x=sexe)+
  geom_bar(position="fill")
```

```{r}
coco6 %>% 
  filter(is.na(triste)==F) %>% 
ggplot()+
  aes(fill=nerveux, x=sexe)+
  geom_bar(position="fill")

#fusionner les deux vagues
s_triste <- cbind(triste1, triste6)
#presenter le tableau

s_triste_df <- as.data.frame(s_triste)
colnames(s_triste_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

s_triste_df <- rownames_to_column(s_triste_df, "Degré de triste")

#library(gt)
s_triste_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))
```

Enfin, il y a la trisetesse. Il n'y a pas de changement significatif dans la proportion d'homme et de femmes qui se sentent toujours seuls. Un peu plus de femmes que d'hommes se sentent toujours seuls. 


Dans les vagues précédentes de solitude, de nervosité et de décourage, les hommes avaient toujours ces sentiments dans la première vague, mais dans la sixième vague, on a cnstaté que les femmes avaient tendance à avoir ces sentiments plus fortement ou elles ne changent rien. Cela signifie qu'il y a une raison pour que les femmes éprouvent plus fortement ces sentiments négatifs.
La trisetesse, en revanche, tend à être un sentiment constant de triste, quel que soit le sexe.

## Les facteurs qui affecte (éventuellement) le bien-être et la santé mentale 

Maintenant on va observer les variables qui peuvent avoir un impact direct ou indirect sur le bien-être et la santé mentale de la population etudiée. Le choix de ces varibles répose sur les trois domaines suivants:

- la santé physique
- la vie sociale
- les activités de la vie quotidiennes, le confinement et le télétravail


### Santé physique

```{r}
#état de santé percu (Diriez-vous que, dans l'ensemble, votre santé est :)

#recodage de la variable
fct_sante <- function(x){
  recod <- fct_collapse(factor(x),
  "Très bon"="1", 
  "Bon"="2", 
  "Assez bon"="3",
  "Mauvais"="4",
  "Très mauvais"="5",
  "N'a pas repondu"="9999")
  return(recod)
}
coco1$sante <- fct_sante(coco1$coco1_q04)
coco6$sante <- fct_sante(coco6$coco6_Q04)

# vague 1
sante_vague1 <- wtd.table(coco1$sante,coco1$sexe, weights = coco1$coco1_POIDS,
          useNA = "ifany", exclude = "N'a pas repondu") %>%
  prop(digits=1)
#vague 6
sante_vague6 <- wtd.table(coco6$sante,coco6$sexe, weights = coco6$POIDS_coco6,
          useNA = "ifany", exclude = "N'a pas repondu") %>%
  prop(digits=1)

#fusionner les deux vagues
t_sante <- cbind(sante_vague1, sante_vague6)
#presenter le tableau

t_sante_df <- as.data.frame(t_sante)
colnames(t_sante_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")


t_sante_df <- rownames_to_column(t_sante_df, "Etat de santé")


t_sante_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = c(4,7)))

```

Les personnes interrogées se declarent majoritairement (~95%) en très bon, bon ou assez bon état de santé et il n'y a pas de differences significatives entre les deux vagues de l'enquete ainsi que entre les deux sexes. 

### Poids des individus
```{r}
# coco1_q05_c: Poids en kg
#recodage
fct_poids <- function(x){
  recod <- fct_collapse(factor(x),
  "Moins de 55 kg"="1", 
  "Entre 55 et 64 kg"= c("2","3"), 
  "Entre 65 et 74"= c("4", "5"),
  "Entre 75 et 84 heures"= c("6","7"),
  "85 kg et plus"= c("8", "9"),
  "RefRep,NSP,NR" = c("7777","8888","9999"))
  return(recod)
}

coco1$poids <- fct_poids(coco1$coco1_q05_c)
coco6$poids <- fct_poids(coco6$coco6_Q05_c)


#vague 1
poids1 <- wtd.table(coco1$poids,coco1$sexe, weights = coco1$coco1_POIDS,
          useNA = "ifany", exclude = "RefRep,NSP,NR") %>%
  prop(digits=1)

#vague 6
poids6 <- wtd.table(coco6$poids,coco6$sexe, weights = coco6$POIDS_coco6,
          useNA = "ifany", exclude = "RefRep,NSP,NR") %>%
  prop(digits=1)

#fusionner les deux vagues
t_poids <- cbind(poids1, poids6)
#presenter le tableau

t_poids_df <- as.data.frame(t_poids)
colnames(t_poids_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

t_poids_df <- rownames_to_column(t_poids_df, "Poids")


t_poids_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))
```

En revanche, le poids des enquêtées semble d'être affecté par le confinement, puisque lors de la deuxième vague de l'enquête la proportion des personnes obèses (85kg et plus) est d'environ 2 fois et demi supérieur à celle de la première vague(il est passé de 11,8% à 28,8% après le confinement). Ces resultats sont cohérents avec ceux obtenus dans une étude mené par la Santé Publique dans le but d'observer les comportements alimentaires des Français pendant le confinement ("Comportements alimentaires et déterminants de la prise de poids des adultes en France pendant le confinement lié à la Covid-19: évolutions perçues" (CoviPrev, 2020)).

Il faut noter également que parmi les personnes qui pèsent 75kg et plus les hommes sont surreprésentés dans les deux vagues alors que 37% (53% dans la deuxième vague) de la population sont les femmes dont le poids est moins de 75kg. 

### Fréquence de l'activité sportive 
```{r}
#eayy_K3: Fréquence activité sportive 30 minutes d'affilée

#recodage de la variable
fct_sport <- function(x){
  recod <- fct_collapse(factor(x),
  "Tous les jours"="1", 
  "Plusieurs fois par semaine"="2", 
  "Une fois par semaine"="3",
  "1 à 3 fois par mois"="4",
  "Moins souvent"="5",
  "9"="9")
  return(recod)
}

coco1$sport <- fct_sport(coco1$eayy_K3)
coco6$sport <- fct_sport(coco6$eayy_K3)

sport1 <- wtd.table(coco1$sport, coco1$sexe, weights = coco1$coco1_POIDS,
          exclude = "9",useNA = "ifany") %>%
  prop(digits=1)

sport6 <- wtd.table(coco6$sport, coco6$sexe, weights = coco6$POIDS_coco6,
          exclude = "9", useNA = "ifany") %>%
  prop(digits=1)

#fusionner les deux vagues
t_sport <- cbind(sport1, sport6)
#presenter le tableau

t_sport_df <- as.data.frame(t_sport)
colnames(t_sport_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

t_sport_df <- rownames_to_column(t_sport_df, "Fréquence")

t_sport_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))
```

Les femmes sont légerement plus susceptibles de pratiquer une activité sportive 30 minutes d'affilée plusieurs fois par semaine au lieu de tous les jours. Sinon, avec la fréquence moins elevé les résultats obtenus pendant le confinement ainsi que après sa fin sont similaires entre les deux sexes. 

### Le sommeil
```{r}
# coco1_q59_6: Temps consacré à dormir
fct_temps_actvt <- function(x){
  recod <- fct_collapse(factor(x),
  "Je n’ai pas fait cette activité"="1", 
  "Entre 0 et 4 heure"= c("2","3","4", "5"), 
  "Entre 4 et 6 heures"="6",
  "Entre 6 et 8 heures"="7",
  "8 heures et plus"= c("8", "9"),
  "9999" = "9999")
  return(recod)
}


coco1$sommeil <- fct_temps_actvt(coco1$coco1_q59_6)
coco6$sommeil <- fct_temps_actvt(coco6$coco6_q59_6)

#vague 1
sommeil_1 <- wtd.table(coco1$sommeil, coco1$sexe, weights = coco1$coco1_POIDS, exclude = "9999",useNA = "ifany") %>%
  prop(digits=1)

#vague 6
sommeil_6 <- wtd.table(coco6$sommeil, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "9999",useNA = "ifany") %>%
  prop(digits=1)

#fusionner les deux vagues
t_sommeil <- cbind(sommeil_1, sommeil_6)

#présenter le tableau

t_sommeil_df <- as.data.frame(t_sommeil)
colnames(t_sommeil_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

t_sommeil_df <- rownames_to_column(t_sommeil_df, "Fréquence")

t_sommeil_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))

```

On trouve quelques changement dans les habitudes de sommeil des Français après le premier confinement. Par exemple, lors de la deuxième vague de l'enquete la moitié des personnes interrogées a déclaré d'avoir consacré entre 6h et 8h par jour pour le sommeil pendant les deux dernières semaines contre 36% au debut du confinement. Pourtant, le nombre des personnes qui dort 8h et a baissé de 10% après le confinement.  

Globalement, la proportion des enquetés qui dorment entre 0 et 6h a légèrement diminué et le nombre des personnes qui consacrent plus de 6h pour le sommeil est devenu un peu plus elevé. 


## La vie sociale
On vit dans la sosiété c'est-à-dire que l'on cammunique avec les gens comme d'habitude mais il y a une difficulté  pendant le confinement. Est-ce que l'on a la chance de communiquer avec des amis et la famille dans la vie réelle?

### Rencontres avec des amis 

```{r}
### coco1_q52_1: Fréquence des rencontres avec des amis dans la vie réelle
#Pendant les deux dernières semaines, à quelle fréquence avez-vous vu les personnes suivantes (en dehors des personnes avec qui vous logez) ?
# Créer la fonction
fct_freq_renco <- function(x){
  recod <- fct_collapse(factor(x),
  "8 fois ou plus"="1", 
  "Entre 5 et 7 fois"="2", 
  "3 ou 4 fois"="3",
  "1 ou 2 fois"="4",
  "Jamais" = "5")
  return(recod)
}
# Recodage
coco1$rencontres_amis_reel <- fct_freq_renco(coco1$coco1_q52_1)
coco6$rencontres_amis_reel <- fct_freq_renco(coco6$coco6_q52_1)

#vague 1
renco_amis1 <- wtd.table(coco1$rencontres_amis_reel, coco1$sexe, weights = coco1$coco1_POIDS, exclude = "9999",useNA = "ifany") %>%
  prop(digits=1)

#vague 6
renco_amis6 <- wtd.table(coco6$rencontres_amis_reel, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "9999",useNA = "ifany") %>%
  prop(digits=1)

#fusionner les deux vagues
t_renco_amis <- cbind(renco_amis1, renco_amis6)

#présenter le tableau

t_renco_amis_df <- as.data.frame(t_renco_amis)
colnames(t_renco_amis_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

t_renco_amis_df <- rownames_to_column(t_renco_amis_df, "Fréquence")

t_renco_amis_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))
```

### Rencontres avec la famille
```{r}
###coco1_q52_3: Fréquence des rencontres avec la famille dans la vie réelle
# Recodage
coco1$rencontres_fam_reel <- fct_freq_renco(coco1$coco1_q52_3)
coco6$rencontres_fam_reel <- fct_freq_renco(coco6$coco6_q52_3)

#vague 1
renco_fam1 <- wtd.table(coco1$rencontres_fam_reel, coco1$sexe, weights = coco1$coco1_POIDS, exclude = "9999",useNA = "ifany") %>%
  prop(digits=1)

#vague 6
renco_fam6 <- wtd.table(coco6$rencontres_fam_reel, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "9999",useNA = "ifany") %>%
  prop(digits=1)

#fusionner les deux vagues
t_renco_fam <- cbind(renco_fam1, renco_fam6)

#présenter le tableau

t_renco_fam_df <- as.data.frame(t_renco_fam)
colnames(t_renco_fam_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

t_renco_fam_df <- rownames_to_column(t_renco_fam_df, "Fréquence")

t_renco_fam_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))
```

La grande majorité de la population étudiée a repondu de ne jamais voir (rencontres physiques) leurs amis ou les membres de leur famille en dehors des personnes qui sont logées avec elles deux semaines precedant l'enquete. Les resultas sont similaires pour les deux vagues et les deux sexes. 

## Les activités de la vie quotidienne et les avis sur le confinement et le télétravail

### Temps consacré à faire du ménage (pendant le confinement)
```{r}

fct_temps_menage <- function(x){
  recod <- fct_collapse(factor(x),
  "Je n’ai pas fait cette activité"="1", 
  "Entre 0 et 1 heure"= "2", 
  "Entre 1 et 2 heaures" = "3",
  "Entre 2 et 3 heures" = "4",
  "Entre 3 et 10 heures"= c("5","6", "7", "8"),
  "10 heures et plus"="7",
  "PDR" = "9999")
  return(recod)
}


coco1$menage <- fct_temps_menage(coco1$coco1_q59_1)

wtd.table(coco1$menage, coco1$sexe, weights = coco1$coco1_POIDS, exclude = c("9999", "9", "PDR"),useNA = "ifany") %>%
  prop(digits=1)

```

La majorité des personnes (83%) au début du confinement consacrent en moyenne entre 0 et 3h par jour pour le ménage. 
Globalement, les femmes sont plus nombreuses à s'occuper du menage selon les resultas obténus. Environ 7,2% des interrogés consacrent entre plus de 3h par jour pour cette tâche dont 5,8% sont les femmes.


### Confinement

*Description de l'expérience du confinement*
```{r}
#coco1_q62: 

fct_conf <- function(x){
  recod <- fct_collapse(factor(x),
  "C'est une expérience qui nous fait perdre beaucoup de temps" = "1",
  "C'est une expérience qui permet de prendre du recul et réfléchir à
son mode de vie"= "2", 
  "C'est une expérience qui permet de consacrer du temps à des choses
essentielles comme la famille, les amis et les enfants"="3",
  "C’est une expérience qui fatigue les nerfs"="4",
  "PDR" = "9999")
  return(recod)
}

coco1$conf <- fct_conf(coco1$coco1_q62)
coco6$conf <- fct_conf(coco6$coco6_Q62mod)

#vague 1
conf_1 <- wtd.table(coco1$conf, coco1$sexe, weights = coco1$coco1_POIDS, exclude = c("PDR","9999"),,useNA = "ifany") %>%
  prop(digits=1)

#vague 6
conf_6 <- wtd.table(coco6$conf, coco6$sexe, weights = coco6$POIDS_coco6, exclude = c("PDR","9999"),useNA = "ifany") %>%
  prop(digits=1)

#fusionner les deux vagues
t_conf_df <- cbind(conf_1, conf_6)

#présenter le tableau

t_conf_df <- as.data.frame(t_conf_df)
colnames(t_conf_df) <- c("Homme", "Femme", "Total", "homme", "femme", "total")

t_conf_df <- rownames_to_column(t_conf_df, "Avis sur l'expérience du confinement")

t_conf_df %>%
  gt() %>%
  tab_spanner(label = "Vague 1", columns = c(2, 3, 4)) %>%
  tab_spanner(label = "Vague 6", columns = c(5, 6, 7)) %>%
  tab_style(
    style = list(cell_text(weight = "bold")),
    locations = cells_body(columns = c(4,7)))
```

Au moment de la prémière vague de l'enquete un quart (26%) de la population s'exprime négativement concernant le confinement. En effet, environ 7% le voient comme la perte de temps et pour 19% c'est une experience qui fatigue les nerfs. Quelques mois après le confinement, le nombre des personnes avec ces opinions atteint 36%.  

### Stress lié au confinement
```{r}
#Dans l’ensemble le confinement vous pèse…

fct_stress_conf <- function(x){
  recod <- fct_collapse(factor(x),
  "0 Pas du tout" = "0",
  "10 Enormément"="10")
  return(recod)
}

coco1$conf_stress <- fct_stress_conf(coco1$coco1_q64)

#vague 1
wtd.table(coco1$conf_stress, coco1$sexe, weights = coco1$coco1_POIDS, exclude = "9999",,useNA = "ifany") %>%
  prop(digits=1)

```

Pour la moitié de la population le confinement est une expérience assez ou énormèment stressante(sur l'échelle de 0 à 10 ils ont choisi 6,7,8,9 ou 10). Seulement 7% des personnes considèrent que le confinèment n'est pas du tout stressant pour elles(0). Selon les résultats obténus, les femmes et les hommes sont affecté par le confinement presque de la même  manière.

### *Avis télétravail(après le confinement)*

*Avis télétravail : permet d'optimiser sa journée*
```{r}
# coco6_Q132_1: 

fct_avis_teletravail <- function(x){
  recod <- fct_collapse(factor(x),
  "Oui"="1", 
  "Non"= "2",
  "PDR" = "9999")
  return(recod)
}

coco6$avis1 <- fct_avis_teletravail(coco6$coco6_Q132_1)

wtd.table(coco6$avis1, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "PDR",useNA = "ifany") %>%
  prop(digits=1)

```

*Avis télétravail : permet de se concentrer*
```{r}

coco6$avis2 <- fct_avis_teletravail(coco6$coco6_Q132_2)

wtd.table(coco6$avis2, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "PDR",useNA = "ifany") %>%
  prop(digits=1)
```

*Avis télétravail : mélange trop vie privée et vie professionnelle*
```{r}

coco6$avis3 <- fct_avis_teletravail(coco6$coco6_Q132_3)

wtd.table(coco6$avis3, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "PDR",useNA = "ifany") %>%
  prop(digits=1)
```

*Avis télétravail : diminue efficacité*
```{r}

coco6$avis4 <- fct_avis_teletravail(coco6$coco6_Q132_4)

wtd.table(coco6$avis4, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "PDR",useNA = "ifany") %>%
  prop(digits=1)
```

Concernant l'avis sur le télétravail, la majorité des répondant pense que ce mode de travail permets d'optimiser sa journée(62%). Par contre, pour le reste de la population ce n'est pas le cas. Par ailleurs, 75% repondent négativement quand on leur demande si le télétravail permets de se concentrer et 35% pensent que le télétravail rend la conciliation de la vie privée avec la vie professionnelle plus compliquée puisque les limites entre les deux disparaissent. Pour 15% de la population le télétravail est également le source une source de la baisse de l'efficacité. 



### Avis sur quotidien (après le confinement)

*Avis sur quotidien : journées denses*
```{r}

fct_avis_quotidien <- function(x){
  recod <- fct_collapse(factor(x),
  "Tout à fait d'accord" = "1",
  "Plutôt d'accord" = "2",
  "Plutôt pas d'accord" = "3",
  "Pas du tout d'accord" = "4",
  "PDR" = "9999")
  return(recod)
}

coco6$avis_q1 <- fct_avis_quotidien(coco6$coco6_Q200_2)

wtd.table(coco6$avis_q1, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "PDR",useNA = "ifany") %>%
  prop(digits=1)
```

*Avis sur quotidien : permet de profiter de la vie*
```{r}

coco6$avis_q2 <- fct_avis_quotidien(coco6$coco6_Q200_3)

wtd.table(coco6$avis_q2, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "PDR",useNA = "ifany") %>%
  prop(digits=1)
```

*Avis sur quotidien : stress intense*
```{r}

coco6$avis_q3 <- fct_avis_quotidien(coco6$coco6_Q200_4)

wtd.table(coco6$avis_q3, coco6$sexe, weights = coco6$POIDS_coco6, exclude = "PDR",useNA = "ifany") %>%
  prop(digits=1)
```
Pour 53% de la population étudiée leurs journées sont très denses et frénétiques et la moitie des individus enquêtés ne pense pas que leur vie leurs donne beaucoup d'occasions de profiter de la vie. Enfin, pour le tiers de la population (~28%) leur vie quotidinne est un stress intense.

## Test statistique

Maintenant on souhate savoir si le degré de nervosité pendant le confinement est lié avec le fait d'être une femme ou un homme.

### Tableau croisé

```{r}
addmargins(table(coco1$sexe, coco1$nerveux, useNA="ifany"))
```

On remarque que le nombre des femmes qui se sentent en premanence, souvent ou quelques fois seules pendant les deux semaines précedant l'enquête est significativement plus elévé. Ainsi, cela serait judicieux de tester cette hypothèse avec le test khi-2. 


### Test d'indépendance khi-2

```{r}
chisq.test(table(coco1$sexe, coco1$coco1_q16))
```

D'après les resultas obténus (notamment le p-value), on trouve l'association très significative entre ces deux variables. On peut alors conclure que probablement il existe un lien entre le fait d'être une femme ou un homme et le sentiment de nervosité dû à la pandémie et le confinement. 

## Carte
```{r}

# Import du fichier shp :
reg_sf <- st_read(dsn="~/GitHub/R_project/regions/regions-20180101.shp")
class(reg_sf)
names(reg_sf)
str(reg_sf)

# Geom_sf est la couche couche cartographique
ggplot()+
  geom_sf(data=reg_sf)

# Transformer
reg_sf <- st_transform(reg_sf,crs=2154)

# Ajout de données : Depuis le 23 mars 2020, Santé publique France a lancé l'enquête CoviPrev en population générale afin de suivre l’évolution des comportements (gestes barrières, confinement, consommation d’alcool et de tabac, alimentation et activité physique) et de la santé mentale (bien-être, troubles).
anx <- read.csv2("~/GitHub/R_project/donnees_anxiete_reg_vague1.csv") # import
names(anx)
str(anx)
anx$reg = as.character(anx$reg)

# Il faut supprimer les dom-tom dans reg_sf avant de fusionner les 2, sinon la carte sera une couche énorme mais sans info sur les dom-tom
reg_sff <- left_join(reg_sf, anx, by =c("code_insee" = "reg"))

```

# Conclusion 
